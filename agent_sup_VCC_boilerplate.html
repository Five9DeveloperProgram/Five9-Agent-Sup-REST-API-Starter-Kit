<!doctype html>
<html>     
    <head>
        <meta charset="utf-8">
        <meta name="description" content="Boilerplate and high-level howto guide with starter examples to use the Five9 VCC Agent and Supervisor REST API">
        <meta name="author" content="andrew.willey@five9.com">

        <title>Five9 VCC Agent and Supervisor REST API Wrappers</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
    </head>
    <body>
        <main class="container">
            <div class="row">
                <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
                    <div class="position-sticky sticky-top pt-3">
                        <p>Sample Wrapped Methods</p>
                        <p id="login-required-message"><small class="text-muted">Log into Five9 in <a href="https://login.five9.com" target="_blank">another tab</a> for working examples</small></p>                  
                        <ul class="nav flex-column example-links">
                            <li class="nav-item">
                                <a class="nav-link f9-call-external-number" href="#">Call External Number</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link f9-recording-pause" href="#">Stop Recording on Current Call</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link f9-recording-resume" href="#">Start Recording on Current Call</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link f9-conference-transfer" href="#">Initiate Conference Transfer</a>
                            </li>
                            <li class="nam-item">
                                <a class="nav-link f9-get-prompts" href="#">Get list of available prompts</a>
                            </li>
                            <li class="nam-item">
                                <a class="nav-link f9-play-prompt" href="#">Play a prompt</a>
                            </li>
                            <li class="nam-item">
                                <a class="nav-link f9-disposeCurrentCall" href="#">End current call with a set dispositionId</a>
                            </li>
                            <li class="nam-item">
                                <a class="nav-link f9-getDomainContactFields" href="#">Obtain Domain Contact Fields</a>
                            </li>
                            <li class="nam-item">
                                <a class="nav-link f9-updatecontact" href="#">Update Contact Record</a>
                            </li>
                            <li class="nam-item">
                                <a class="nav-link f9-getCurrentCalls" href="#">Get Current Calls</a>
                            </li>
                            <li class="nam-item">
                                <a class="nav-link f9-getDomainCallVariables" href="#">Get Domain Call Variables</a>
                            </li>
                            <li class="nam-item">
                                <a class="nav-link f9-getDomainSpeedDials" href="#">Get Domain Speed Dials</a>
                            </li>
                            <li class="nam-item">
                                <a class="nav-link f9-getEwtForSkill" href="#">Get EWT for skill</a>
                            </li>
                        </ul>
                        <small>use CTRL-SHIFT-J to open the java console to view logging events and other data</small>
                    </div>
                </nav>
                <div class="col-md-9 col-lg-10">
                    <h1>VCC Agent/Supervisor REST API Boilerplate with Examples</h1>

                    <p>
                        As described in the <a href="https://webapps.five9.com/assets/files/for_customers/documentation/apis/vcc-agent+supervisor-rest-api-reference-guide.pdf">documentation</a>, using the VCC REST API endpoints follows this pattern
                        <ul>
                            <li>Obtain session metadata from https://app.five9.com/appsvcs/rs/svc/auth/metadata</li>
                            <li>Build the base api url (API domain:port)</li>
                            <li>Determine the appropriate context path for the endpoint</li>                        
                            <li>Invoke the method with the fully formed path</li>
                        </ul>
                    </p>
                    <h4>Obtaining the metadata</h4>
                    <p> 
                        If you are logged into the Agent or Supervisor applications in the same browser as the page you are using the APIs from, then your request for the metadata will use the existing session from the Agent or Supervisor application and you can obtain the metadata without needing to provide user credentials explicitly.
                    </p>
                    <h4>Building the Endpoint URL</h4>
                    <p>
                        The session metadata will contain the logged-in user's userId, orgId, and the host information. 
                        <a href="#" id="toggle-metadata" class="text-decoration-none">Toggle Metadata Sample</a></toggle>
                            <pre class="metadata">
*** SAMPLE - Log into the Agent or Supervisor apps in another tab and refresh for this to show your metadata ***
{
    "tokenId": "e34ff153-72cb-11eb-aab9-0050asdfd2232",
    "sessionId": "fb81eddd76ec0f096a0d1be188ae240e1f94469ee956d13da5356b8eaasdfasdf",
    "orgId": "112342346331",
    "userId": "323400000552352",
    "context": {
        "cloudClientUrl": null,
        "pwdExpiryDays": "78",
        "cloudTokenUrl": null,
        "farmId": "3000000000000055511"
    },
    "metadata": {
        "freedomUrl": "https://app.five9.com",
        "dataCenters": [
            {
                "name": "Atlanta Data Center",
                "uiUrls": [
                    {
                        "host": "app-atl.five9.com",
                        "port": "443",
                        "routeKey": "ATLUIjdhnJ",
                        "version": "12.0.93"
                    }
                ],
                "apiUrls": [
                    {
                        "host": "app-atl.five9.com",
                        "port": "443",
                        "routeKey": "ATLAPILxUX",
                        "version": "12.0.93"
                    }
                ],
                "loginUrls": [
                    {
                        "host": "app-atl.five9.com",
                        "port": "443",
                        "routeKey": "ATLLGNPOE9",
                        "version": "12.0.41"
                    }
                ],
                "active": true
            }
        ]
    }
}                                
                            </pre>

                        A fully-formed URL will look like this:
                        <pre>
https://<span class="bg-primary text-light">{   api host:port   }</span><span class="bg-info">/{  ctxt path }/</span><span class="bg-success text-light">{ ctxt identifier }/</span><span class="bg-secondary text-light">{ api method with path elements }</span>
https://<span class="bg-primary text-light">app-scl.five9.com:443</span><span class="bg-info">/appsvcs/rs/svc/</span><span class="bg-success text-light">agents/357892724324/</span><span class="bg-secondary text-light">interactions/calls/D919FFB8258B45D7BFED2786BF45C42F/pause_recording</span>
                        </pre>
                    </p>

                     <h3>The Bootstrap</h3>
                    <p>Here is an example of how to obtain the metadata in a reusable manner.  Note the placeholder for wrapped methods you may add in later.</p>
                    <pre>
let freedomMetadataURL = "https://app.five9.com/appsvcs/rs/svc/auth/metadata";
let five9SessionData;


/** 
* API Context Paths:
*      Agent REST API Services "agent_rest": "/appsvcs/rs/svc",
*      Agent call recordings and email message attachments "agent_str": "/strsvcs/rs/svc",
*      Supervisor REST API Services "sup_rest": "/supsvcs/rs/svc"
*/
let contextPaths = {
    "agent_rest": "/appsvcs/rs/svc",
    "agent_str": "/strsvcs/rs/svc",
    "sup_rest": "/supsvcs/rs/svc"
}

let base_api_url;
let base_agents_api_url;
let base_supervisor_api_url;

let f9OrgId;
let f9UserId;
                        
/**************************************
    *                                    *
    * API Endpoint Wrappers will go here *
    *                                    *
    **************************************/        

// Obtain the metadata
(function($){
    $.ajaxSetup({
        crossDomain: true,
        async: false,
        xhrFields: {
            withCredentials: true
        }
    });


    $.get(freedomMetadataURL, function( data ) {
        five9SessionData = data;
        f9OrgId = five9SessionData.orgId;
        f9UserId = five9SessionData.userId;

        base_api_url = "https://" + five9SessionData.metadata.dataCenters[0].apiUrls[0].host + ":" + five9SessionData.metadata.dataCenters[0].apiUrls[0].port;
        base_agents_api_url = base_api_url + contextPaths.agent_rest;
        base_supervisor_api_url = base_api_url + contextPaths.sup_rest;

        console.log(("user ID: " + five9SessionData.userId));
        console.log("Base Supervisor API URL: " + base_supervisor_api_url);
        console.log("Base Agent API URL: " + base_agents_api_url);
    });    
})(jQuery)
                    </pre>

                    <h3>Wrapping Endpoints</h3>
                    <p>Refer to the <a href="https://webapps.five9.com/assets/files/for_customers/documentation/apis/vcc-agent+supervisor-rest-api-reference-guide.pdf">VCC Agent+Supervisor Rest API Reference Guide</a> and follow these patterns</p>
                    <p>Each endpoint will require either the <strong>base_agents_api_url</strong> or the <strong>base_supervisor_api_url</strong> to use the correct context path.  Most agent endpoints will need <strong>"/agents/"</strong> appended, though some will use something else like <strong>"/orgs/"</strong>.  </p>
                    <p>As a best practice, document each wrapper function with at least the path example from documentation.  Consider including some of the payload documentation or even a sample response.</p>
                    <h4>GET Methods</h4>
                    <p>In this example, we use a GET method for the methods that only require <strong>path</strong> parameters.</p>
                    <pre>
/**
* getCurrentCalls returns an array of calls [&lt;object CallInfo&gt;, ] with which the agent can work
* 
* Five9 VCC Agent API Method:
*   GET /agents/{agentId}/interactions/calls
* 
* Five9 Response Sample:
*   [{id: "C86EBE50B9744D6D946531842B278846", campaignId: "1137597", callType: "AGENT", transfer: false, userTransferringId: null, ...}, ...]
*/
function getCurrentCalls(){
    let calls;

    let endpointURL = base_agents_api_url+"/agents/"+f9UserId+"/interactions/calls";
    console.log(endpointURL);

    $.get( endpointURL, function(res){
        console.log("Returned calls:");
        console.log(res);
        calls = res;
    });
    return calls;
}                                
                    
                    </pre>

                    <h4>POST Methods</h4>                    
                    <p>In this example using the <strong>add_external_to_conference</strong> agent endpoint, the response from <strong>getCurrentCalls</strong> is used to obtain a required parameter for the payload.</p>
                    <pre>
/**
* initiateConferenceTransfer adds a DNIS to the call.  Set warm=true for a warm conference (1st party on hold). 
* 
* Five9 VCC Agent API Method:
*   POST /agents/{agentId}/interactions/calls/{callId}/add_external_to_conference
* 
* Five9 Response Sample:
*   
*/
function initiateConferenceTransfer(dnis, warm=false, checkDNC=true, includeCallerInfo=true){
    let activeCalls = getCurrentCalls();
    let callId = activeCalls[0].id;
    
    let destinationInfo = JSON.stringify({
        "number": dnis, 
        "warm": warm, 
        "checkDNC": checkDNC, 
        "includeCallerInfo": includeCallerInfo
    });

    let endpointURL = base_agents_api_url+"/agents/"+f9UserId+"/interactions/calls/"+callId+"/add_external_to_conference";
    console.log(endpointURL);

    $.ajax({
        url: endpointURL,
        type: 'POST',
        data: destinationInfo,
        contentType: "application/json",
        success: function(res) {
            console.log("Conference Response ")
            console.log(res);
        }
    });	
}
                    </pre>

                </div>
            </div>
        </main>

        <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js" integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous"></script>                
        
        <script type="text/javascript">
            let freedomMetadataURL = "https://app.five9.com/appsvcs/rs/svc/auth/metadata";
            let five9SessionData;

            /** 
            * API Context Paths:
            *      Agent REST API Services "agent_rest": "/appsvcs/rs/svc",
            *      Agent call recordings and email message attachments "agent_str": "/strsvcs/rs/svc",
            *      Supervisor REST API Services "sup_rest": "/supsvcs/rs/svc"
            */
            let contextPaths = {
                "agent_rest": "/appsvcs/rs/svc",
                "agent_str": "/strsvcs/rs/svc",
                "sup_rest": "/supsvcs/rs/svc"
            }

            let base_api_url;
            let base_agents_api_url;
            let base_supervisor_api_url;

            let f9OrgId;
            let f9UserId;

            let DEFAULT_CAMPAIGN_NAME = "ob_outreach";
            let DEFAULT_DISPOSITION_ID = "1130796";

            /**
            * getCampaignInfo returns a CampaignInfo object, requires a campaignId.
            * 
            * Five9 VCC Agent API Method:
            *   GET /orgs/{orgId}/campaigns/{campaignId}
            * 
            * Five9 Response sample:
            *   {
            *       "id":"2494",
            *       "name":"Inbound Service",
            *       "campaignType":"INBOUND",
            *       "customSource":null,
            *       "customIcon":null,
            *       "assistances":[],
            *       "attributes":[],
            *       "avatarURL":null,
            *       "chatWelcomeMessage":null,
            *       "chatTerminateMessage":null,
            *       "outEmail":null,
            *       "skillIds":[],
            *       "state":"RUNNING",
            *       "flags":["PASS_CONTACTS_ANI_FOR_3RD_PARTY_CONFERENCES"]
            *   }
            * 
            * Method return sample:
            *   <object campaignInfo>  
            */
            function getCampaignInfo(campaignId) {
                let campaignInfo;
                $.get(base_agents_api_url+"/orgs/"+f9OrgId+"/campaigns/"+campaignId, function(res){
                    // nconsole.log("CampaignInfo " + campaignId + " DETAIL: ");
                    // console.log(res);
                    campaignInfo = res;
                  });
                return campaignInfo;
            }


            /**
            * getAgentCampaigns returns a dictionary of campaignInfo objects the agent skills give them access to, with the campaign name as the key.
            * 
            * Five9 VCC Agent API Method:
            *   GET /agents/{agentId}/campaigns_config
            * 
            * Five9 Response sample:
            * ["1234", "43802", "23423"]
            * 
            * method return sample:
            * {"Inbound Service": <object campaignInfo>, "Outbound Outreach": <object campaignInfo>}
            */
            function getAgentCampaigns(){
                let agentCampaignsInfo = {};

                let endpointURL = base_agents_api_url+"/agents/"+f9UserId+"/campaigns_config"; 

                console.log(endpointURL);
                $.get(endpointURL, function(res){
                    console.log("Agent Campaigns:")
                    console.log(res);
                    res.campaignIds.forEach(function(campaignId, index){
                        let campaign = getCampaignInfo(campaignId);
                        //console.log("CAMPAIGN DETIAL");
                        //console.log(campaign);
                        agentCampaignsInfo[campaign.name] = campaign;
                    });
                });                
                // console.log("CampaignsConfigInfo: ");
                // console.log(agentCampaignsInfo);
                return agentCampaignsInfo;
            }


            /**
            * callExternalNumber initiates an outbound call to a dnis and requires EITHER a campaignName OR campaignId which will be used to make the call
            * 
            * Five9 VCC Agent API Method:
            *   POST /agents/{agentId}/interactions/make_external_call
            * 
            * Five9 Response sample:
            *     undefined
            *     (status 200 OK)
            */
            function callExternalNumber(dnis, campaignName=null, campaignId=null){
                
                if(campaignId == null && campaignName == null){
                    console.log("callExternalNumber() requires a campaignName or campaignId")
                }

                ExternalCallDestinationInfo = {
                    number: dnis,
                    campaignId: campaignId
                };

                if(campaignId == null){
                    agentCampaigns = getAgentCampaigns();
                    ExternalCallDestinationInfo["campaignId"] = agentCampaigns[campaignName].id;
                }

                if(ExternalCallDestinationInfo["campaignId"] == null){
                    console.log("callExternalNumber() did not find a valid campaign name");
                }

                let endpointURL = base_agents_api_url+"/agents/"+f9UserId+"/interactions/make_external_call";
                console.log(endpointURL);
                $.ajax({
                    url: endpointURL,
                    type: 'POST',
                    data: JSON.stringify(ExternalCallDestinationInfo),
                    contentType: "application/json",
                    success: function(success_response) {
                        console.log("Making External Call")
                        console.log(success_response);
                        }
                });
            }

            
            /**
            * getCurrentCalls returns an array of calls [<object CallInfo>, ] with which the agent can work
            * 
            * Five9 VCC Agent API Method:
            *   GET /agents/{agentId}/interactions/calls
            * 
            * Five9 Response Sample <object callInfo>:
            *   [{id: "C86EBE50B9744D6D946531842B278846", campaignId: "1137597", callType: "AGENT", transfer: false, userTransferringId: null, ...}, ...]
            */
            function getCurrentCalls(){
                // let calls;

                let endpointURL = base_agents_api_url+"/agents/"+f9UserId+"/interactions/calls";
                console.log(endpointURL);

                $.get( endpointURL, function(res){
                    console.log("Returned calls:");
                    console.log(res);
                    calls = res;
                });
                return calls;
            }

            
            /**
            * getDomainCallVariables returns the call attached variables for a given callID
            * 
            * Five9 VCC Agent API Method:
            *   GET /orgs/{orgId}/call_variables
            */
            function getDomainCallVariables(){
                let endpointURL = base_agents_api_url+"/orgs/"+f9OrgId+"/call_variables";
                console.log(endpointURL);
                let cavsList = undefined;
                let cavs = {};

                $.get( endpointURL, function(res){
                    console.log("Domain CAVs:");
                    console.log(res);
                    cavsList = res;
                });

                cavsList.forEach((cav) => {
                    cavs[cav.group] = cavs[cav.group] || {};
                    cavs[cav.group][cav.name] = cavs[cav.group][cav.name] || {};
                    cavs[cav.group][cav.name]["id"] = cav.id;
                    cavs[cav.group][cav.name]["type"] = cav.type;
                    cavs[cav.group][cav.name]["restrictions"] = cav.restrictions;
                });
                console.log("Domain CAVs after transformation:");
                console.log(cavs);
                return cavs;
            }


            /**
            * setCallVariableValue returns the call attached variables for a given callID
            * 
            * Five9 VCC Agent API Method:
            *   GET /orgs/{orgId}/call_variables
            */
            function setDomainCallVariable(){
                let endpointURL = base_agents_api_url+"/orgs/"+f9OrgId+"/call_variables";
                console.log(endpointURL);
                let cavs = undefined;

                $.get( endpointURL, function(res){
                    console.log("Domain CAVs:");
                    console.log(res);
                    cavs = res;
                });
                return cavs;
            }

            
            /**
            * getContactFields returns an array of contactFields on the domain
            * 
            * Five9 VCC Agent API Method:
            *   GET /orgs/{orgId}/contact_fields
            * 
            * Five9 Response Sample <object domainContactFields>:
            *   [{dataType: "NUMBER", id: "114", name: "influence_score", primary: false, restrictions: {restrictions: [], limitedSetInfo: null} }, ...]
            */
            function getContactFields(){

                let endpointURL = base_agents_api_url+"/orgs/"+f9OrgId+"/contact_fields";
                console.log(endpointURL);

                $.get( endpointURL, function(res){
                    console.log("Returned domain contact fields:");
                    console.log(res);
                    domainContactFields = res;
                });
                return domainContactFields;
            }


            /**
            * Updates contact info.  Accepts an array of fieldId and Values to update on the record.
            * 
            * Five9 VCC Agent API Method:
            *   PUT /agents/{agentId}/interactions/calls/{callId}/update_contact
            * 
            * Five9 Response Sample:
            *   
            */
            function updateContactInfo(fieldUpdates=[{"1010": "TestFirstName"}]){
                let activeCalls = getCurrentCalls();
                let activeCall = activeCalls[0];

                let callId = activeCall.id;                
                console.log(activeCall);

                // Process Field Updates
                // let contact = getContactById(activeCall.activeContact.id);
                console.log("CONTACT LOOKED UP IS: " + contact);
                for(var i=0; i < fieldUpdates.length; i++){
                    activeCall.activeContact.fields[fieldUpdates[i]] = "AWTEST87";

                }

                let contactInfo = JSON.stringify(activeCall.activeContact);
                console.log(contactInfo);
                let endpointURL = base_agents_api_url+"/agents/"+f9UserId+"/interactions/calls/"+callId+"/update_contact";

                $.ajax({
                    url: endpointURL,
                    type: 'PUT',
                    data: contactInfo,
                    contentType: "application/json",
                    success: function(res) {
                        console.log("ActiveContact Response")
                        console.log(res);
                    }
                });	
            }


            /**
            * pauseCurrentCallRecording stops call recording for a given callId. If no callId is provided, the
            * user's active call is obtained from getCurrentCalls() 
            * 
            * Five9 VCC Agent API Method:
            *   PUT /agents/{agentId}/interactions/calls/{callId}/pause_recording
            * 
            * Five9 Response Sample <object callInfo>:
            *   [{id: "C86EBE50B9744D6D946531842B278846", campaignId: "1137597", callType: "AGENT", transfer: false, userTransferringId: null, ...}, ...]:
            *   
            */
            function pauseCurrentCallRecording(callId=null){
                if(callId === null){
                    let activeCalls = getCurrentCalls();
                    callId = activeCalls[0].id;    
                }
                
                let endpointURL = base_agents_api_url+"/agents/"+f9UserId+"/interactions/calls/"+callId+"/pause_recording";
                console.log(endpointURL);

                $.ajax({
                    url: endpointURL,
                    type: 'PUT',
                    success: function(success_response) {
                        console.log("Recording Paused Response:")
                        console.log(success_response);
                        }
                });
            }


            /**
            * dispose Finishes a call and sets a disposition.  
            * 
            * Requires dispositionId (ID of the disposition to select.  Ignored for Internal calls).
            * 
            * Optional timeout parameter equal to or less than one year (366*24*60*60*1000) in ms.
            * Use when the agent wants to change the default value.
            * 
            * If the disposition flag is MUST_CONFIRM, show a confirmation window to the agent. If the
            * agent confirms the disposition, set the disposition.
            * If the call is associated with a preview session, the call is not necessarily finalized:
            * • If the disposition is not final, the call might be set to the WRAP_UP state. In this
            * case, the preview is set to RENEWING. The server remembers the options
            * parameter in the request to apply the disposition later when the call is finalized.
            * • If the disposition is final, the call and the preview are finalized immediately.
            * 
            * Five9 VCC Agent API Method:
            *   PUT /agents/{agentId}/interactions/calls/{callId}/dispose
            * 
            * Five9 Response Sample <object callInfo>:
            *   [{id: "C86EBE50B9744D6D946531842B278846", campaignId: "1137597", callType: "AGENT", transfer: false, userTransferringId: null, ...}, ...]:
            *   
            */
            function disposeCurrentCall(callId=null, dispositionId, timeout=null){
                if(callId === null){
                    let activeCalls = getCurrentCalls();
                    callId = activeCalls[0].id;    
                }
                
                let endpointURL = base_agents_api_url+"/agents/"+f9UserId+"/interactions/calls/"+callId+"/dispose";
                console.log(endpointURL);
                console.log( callId);
                disposeOptionsInfo = {
                    "dispositionId": dispositionId,
                }

                if(timeout != null) {
                    disposeOptionsInfo["timeout"]
                }

                $.ajax({
                    url: endpointURL,
                    type: 'PUT',
                    data: JSON.stringify(disposeOptionsInfo),
                    contentType: "application/json",
                    success: function(success_response) {
                        console.log("Disposition Response:")
                        console.log(success_response);
                        }
                });
            }


            /**
            * resumeCurrentCallRecording stops call recording for a given callId. If no callId is provided, the
            * user's active call is obtained from getCurrentCalls() 
            * 
            * Five9 VCC Agent API Method:
            *   PUT /agents/{agentId}/interactions/calls/{callId}/resume_recording
            * 
            * Five9 Response Sample <object callInfo>:
            *   [{id: "C86EBE50B9744D6D946531842B278846", campaignId: "1137597", callType: "AGENT", transfer: false, userTransferringId: null, ...}, ...]:
            *   
            */
            function resumeCurrentCallRecording(callId=null){
                if(callId === null){
                    let activeCalls = getCurrentCalls();
                    callId = activeCalls[0].id;    
                }
                
                let endpointURL = base_agents_api_url+"/agents/"+f9UserId+"/interactions/calls/"+callId+"/resume_recording";
                console.log(endpointURL);

                $.ajax({
                    url: endpointURL,
                    type: 'PUT',
                    success: function(success_response) {
                        console.log("Recording Resumed Response:")
                        console.log(success_response);
                        }
                });
            }

            /**
            * initiateConferenceTransfer adds a DNIS to the call.  Set warm=true for a warm conference (1st party on hold). 
            * 
            * Five9 VCC Agent API Method:
            *   POST /agents/{agentId}/interactions/calls/{callId}/add_external_to_conference
            * 
            * Five9 Response Sample:
            *   
            */
            function initiateConferenceTransfer(dnis, warm=false, checkDNC=true, includeCallerInfo=true){
                let activeCalls = getCurrentCalls();
                let callId = activeCalls[0].id;
                
                let destinationInfo = JSON.stringify({
                    "number": dnis, 
                    "warm": warm, 
                    "checkDNC": checkDNC, 
                    "includeCallerInfo": includeCallerInfo
                });

                let endpointURL = base_agents_api_url+"/agents/"+f9UserId+"/interactions/calls/"+callId+"/add_external_to_conference";
                console.log(endpointURL);

                $.ajax({
                    url: endpointURL,
                    type: 'POST',
                    data: destinationInfo,
                    contentType: "application/json",
                    success: function(res) {
                        console.log("Conference Response")
                        console.log(res);
                    }
                });	
            }

            /**
            * initiateTransferToExternal transfers the call to an external number.  Set warm=true for a warm transfer (1st party on hold). 
            * 
            * Five9 VCC Agent API Method:
            *   PUT /agents/{agentId}/interactions/calls/{callId}/transfer_to_external_number
            * 
            * Five9 Response Sample:
            *   
            */
            function initiateTransferToExternal(dnis, dispositionId="-23", dispositionTimeout=300000, timeout=0, warm=false, skipDNCCheck=false){
                let activeCalls = getCurrentCalls();
                let callId = activeCalls[0].id;

                let externalTransferDestinationInfo = JSON.stringify({
                    "destination": {
                        "skipDNCCheck": skipDNCCheck,
                        "checkMultipleContacts": true,
                        "number": dnis, 
                    },
                    // "dispositionId": dispositionId,
                    "warm": warm, 
                    "dispositionTimeout": dispositionTimeout,
                    "timeout": timeout,
                });

                let endpointURL = base_agents_api_url+"/agents/"+f9UserId+"/interactions/calls/"+callId+"/transfer_to_external_number";
                console.log(endpointURL);

                $.ajax({
                    url: endpointURL,
                    type: 'PUT',
                    data: externalTransferDestinationInfo,
                    contentType: "application/json",
                    success: function(res) {
                        console.log("External Transfer Response")
                        console.log(res);
                    }
                });	
            }


            /**
            * addCampaignToConference transfers the call to an external number.  Set warm=true for a warm transfer (1st party on hold). 
            * 
            * Five9 VCC Agent API Method:
            *   PUT /agents/{agentId}/interactions/calls/{callId}/add_campaign_to_conference
            * 
            * Five9 Response Sample:
            *   
            */
            function addCampaignToConference(campaignId="1140040", warm=false){
                let activeCalls = getCurrentCalls();
                let callId = activeCalls[0].id;

                let campaignInfo = JSON.stringify({
                    "campaignId": campaignId,
                    "warm": warm
                });

                let endpointURL = base_agents_api_url+"/agents/"+f9UserId+"/interactions/calls/"+callId+"/add_campaign_to_conference";
                console.log(endpointURL);

                $.ajax({
                    url: endpointURL,
                    type: 'POST',
                    data: campaignInfo,
                    contentType: "application/json",
                    success: function(res) {
                        console.log("Add Campaign To Conference")
                        console.log(res);
                    }
                });	
            }


            /**
            * Returns active skills prompts information for the specified agent
            * 
            * Five9 VCC Agent API Method:
            *   GET /agents/{agentId}/prompts
            * 
            * Five9 Response Sample:
            *   
            */
            function getPrompts(){

                let endpointURL = base_agents_api_url+"/agents/"+f9UserId+"/prompts";
                console.log(endpointURL);

                $.ajax({
                    url: endpointURL,
                    type: 'GET',
                    contentType: "application/json",
                    success: function(res) {
                        console.log("Prompts")
                        console.log(res);
                    }
                });	
            }


            /**
            * Returns speed dials
            * 
            * Five9 VCC Agent API Method:
            *   GET /orgs/{orgId}/speed_dials
            * 
            * Five9 Response Sample:
            *   
            */
            function getDomainSpeedDials(){

                let endpointURL = base_agents_api_url+"/orgs/"+f9OrgId+"/speed_dials";
                console.log(endpointURL);
                let speedDials = undefined;
                $.ajax({
                    url: endpointURL,
                    type: 'GET',
                    contentType: "application/json",
                    success: function(res) {
                        console.log("SpeedDials")
                        console.log(res);
                        speedDials = res;
                    }
                });	
                return speedDials;
            }


            /**
            * get EWT for a specific skill
            * 
            * Five9 VCC Agent API Method:
            *   GET /orgs/{orgId}/speed_dials
            * 
            * Five9 Response Sample:
            *   
            */
            function getEwtForSkill(skillGroupId, mediaTypeId="3000"){

                let endpointURL = base_supervisor_api_url+"/orgs/"+f9OrgId+"/ewt/group/"+skillGroupId+"/"+mediaTypeId;
                console.log(endpointURL);
                let ewtResponse = undefined;
                $.ajax({
                    url: endpointURL,
                    type: 'GET',
                    contentType: "application/json",
                    success: function(res) {
                        console.log("SpeedDials")
                        console.log(res);
                        ewtResponse = res;
                    }
                });	
                return ewtResponse;
            }

            /**
            * play_prompt plays an audio prompt on the agent interaction
            * 
            * Five9 VCC Agent API Method:
            *   PUT /agents/{agentId}/interactions/calls/{callId}/audio/player/play_prompt
            * 
            * Five9 Response Sample:
            *   
            */
            function playPrompt(promptId){
                let activeCalls = getCurrentCalls();
                let callId = activeCalls[0].id;

                let promptInfo = JSON.stringify({
                    "value": promptId
                });

                let endpointURL = base_agents_api_url+"/agents/"+f9UserId+"/interactions/calls/"+callId+"/audio/player/play_prompt";
                console.log(endpointURL);

                $.ajax({
                    url: endpointURL,
                    type: 'PUT',
                    data: promptInfo,
                    contentType: "application/json",
                    success: function(res) {
                        console.log("Conference Response")
                        console.log(res);
                    }
                });	
            }


            /**
            * callRecordingView creates a Call Recording View
            * 
            * Five9 VCC Agent API Method:
            *   POST /supervisors/{supervisorId}/agents/{agentId}/recording_views
            * 
            * Five9 Response Sample:
            *   {id: "e8336041-aceb-4a6b-900a-8bb64ce9ab8b", records: Array(<len>), recordsTotal: <len>, hasMore: false, currentPage: 0}
            */
            function callRecordingView(limit=300, sortField="NAME", ascending=true, target_agentID=""){
                RecordingsViewOptions = JSON.stringify({
                        limit: limit,
                        sortField: sortField.toUpperCase(),
                        ascending: "true"
                });

                let endpointURL = base_supervisor_api_url+"/supervisors/"+f9UserId+"/agents/"+target_agentID+"/recording_views";
                console.log(endpointURL);

                $.ajax({
                    url: endpointURL,
                    type: 'POST',
                    data: RecordingsViewOptions,
                    contentType: "application/json",
                    success: function(res) {
                        console.log("VM List Response")
                        console.log(res);
                    }
                });	
            }




            /**
            * getContactById obtains contact record by ContactId
            * 
            * Five9 VCC Agent API Method:
            *   CONTEXT PATH 
            *   GET /orgs/{orgId}/contacts/{contactId}
            * 
            * Five9 Response Sample:
            *   
            */
            function getContactById(contactId){           
                let endpointURL = base_agents_api_url+"/orgs/"+f9OrgId+"/contacts/"+contactId;
                console.log("getContactById"+endpointURL);

                let contactResult = {};
                $.ajax({
                    url: endpointURL,
                    type: 'GET',
                    //data: contactInfo,
                    contentType: "application/json",
                    success: function(res) {
                        console.log("DomainContactLookup Response")
                        console.log(res);
                    }
                });
            }




            /**
            * assignContactToCall assigns a contact record to a call
            * 
            * Five9 VCC Agent API Method:
            *   CONTEXT PATH /supsvcs/rs/svc
            *   PUT /{agentId}/interactions/calls/{callId}/active_contact_2
            * 
            * Five9 Response Sample:
            *   
            */
            function assignContactToCall(contactId){           
                let callId = getCurrentCalls()[0].id;

                contactResult = getContactById(contactId);
                console.log("here: "+ contactResult);
                let endpointURL = base_agents_api_url+"/agents/"+f9UserId+"/interactions/calls/"+callId+"/active_contact_2";
                console.log(endpointURL);

                let contactInfo = JSON.stringify({
                    "value": contactId
                });

                $.ajax({
                    url: endpointURL,
                    type: 'PUT',
                    data: contactInfo,
                    contentType: "application/json",
                    success: function(res) {
                        console.log("AssignedContact Response")
                        console.log(res);
                    }
                });	
            }

            // Other recommendations for methods to wrap
            // Agent stats
            // Last known station ID
            // Chats closed, emails created
            // GET /supervisors/{supervisorId}/skills/{skillId}/snapshot
            
            (function($){
                $.ajaxSetup({
                    crossDomain: true,
                    async: false,
                    xhrFields: {
                        withCredentials: true
                    }
                });
    
                
                $.get(freedomMetadataURL, function( data ) {
                    five9SessionData = data;
                    f9OrgId = five9SessionData.orgId;
                    f9UserId = five9SessionData.userId;

                    base_api_url = "https://" + five9SessionData.metadata.dataCenters[0].apiUrls[0].host + ":" + five9SessionData.metadata.dataCenters[0].apiUrls[0].port;
                    base_agents_api_url = base_api_url + contextPaths.agent_rest;
                    base_supervisor_api_url = base_api_url + contextPaths.sup_rest;

                    console.log(("user ID: " + five9SessionData.userId));
                    console.log("Base Supervisor API URL: " + base_supervisor_api_url);
                    console.log("Base Agent API URL: " + base_agents_api_url);
                    console.log(JSON.stringify(five9SessionData));
                    $(".example-links").show();

                    $(".metadata").html(JSON.stringify(data, undefined, 2));
                    $("#login-required-message").hide();
                }).fail(function (resp){
                    console.log("You must be logged into Five9 in another browser tab for this to work");
                    $(".example-links").hide();
                });

                window.parent.$(".tab-dropdown-label:contains('Interaction')").click();



            })(jQuery)
        </script>

        <script type="text/javascript">
            $( document ).ready(function() {
                
                $(".metadata").toggle();

                $("#toggle-metadata").click(function(){
                    $(".metadata").toggle();
                });

                $(".f9-call-external-number").click(function(){
                    let dnis = prompt("Enter DNIS to dial");
                    let campaignName = prompt("Enter campaign name to call from", DEFAULT_CAMPAIGN_NAME);
                    callExternalNumber(dnis=dnis, campaignName=campaignName);
                });

                $(".f9-recording-pause").click(function(){
                    pauseCurrentCallRecording();
                });

                $(".f9-recording-resume").click(function(){
                    resumeCurrentCallRecording();
                });

                $(".f9-conference-transfer").click(function(){
                    let dnis = prompt("Enter DNIS to dial");
                    initiateTransferToExternal(dnis=dnis);
                });
                
                $(".f9-get-prompts").click(function(){
                    getPrompts();
                    //playPrompt();
                });
                
                $(".f9-play-prompt").click(function(){
                    //let dnis = prompt("Enter DNIS to dial");
                    //getPrompts();
                    playPrompt("222985");
                });

                $(".f9-sup-callrecordingview").click(function(){
                    callRecordingView();
                });

                

                $(".f9-securePayLite").click(function(){
                    addCampaignToConference();
                });

                $(".f9-updatecontact").click(function(){
                    updateContactInfo();
                });

                $(".f9-getDomainContactFields").click(function(){
                    getContactFields();
                });

                $(".f9-disposeCurrentCall").click(function(){
                    disposeCurrentCall(callId=null, dispositionId=DEFAULT_DISPOSITION_ID);
                });

                $(".f9-getCurrentCalls").click(function(){
                    getCurrentCalls();
                });

                $(".f9-getDomainCallVariables").click(function(){
                    getDomainCallVariables();
                });
                
                $(".f9-getDomainSpeedDials").click(function(){
                    getDomainSpeedDials();
                });

                $(".f9-getEwtForSkill").click(function(){
                    getEwtForSkill();
                });
            });
        </script>
    </body>
</html>